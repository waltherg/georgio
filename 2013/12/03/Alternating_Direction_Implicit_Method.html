<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Title | georg.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Title" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="summary" />
<meta property="og:description" content="summary" />
<link rel="canonical" href="https://georg.io/2013/12/03/Alternating_Direction_Implicit_Method.html" />
<meta property="og:url" content="https://georg.io/2013/12/03/Alternating_Direction_Implicit_Method.html" />
<meta property="og:site_name" content="georg.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-12-03T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"summary","@type":"BlogPosting","headline":"Title","dateModified":"2013-12-03T00:00:00-06:00","datePublished":"2013-12-03T00:00:00-06:00","url":"https://georg.io/2013/12/03/Alternating_Direction_Implicit_Method.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://georg.io/2013/12/03/Alternating_Direction_Implicit_Method.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://georg.io/feed.xml" title="georg.io" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
          ]}
        );
      });
    </script>
  

  <script>
  function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
  }
  window.onload = wrap_img;
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function(){
      // add link icon to anchor tags
      var elem = document.querySelectorAll(".anchor-link")
      elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
      // remove paragraph tags in rendered toc (happens from notebooks)
      var toctags = document.querySelectorAll(".toc-entry")
      toctags.forEach(e => (e.firstElementChild.innerText = e.firstElementChild.innerText.replace('¶', '')))
    });
  </script>
</head><body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">georg.io</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Title</h1><p class="page-description">summary</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2013-12-03T00:00:00-06:00" itemprop="datePublished">
        Dec 3, 2013
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      15 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">
<a href="https://github.com/waltherg/georgio/tree/master/_notebooks/2013-12-03-Alternating_Direction_Implicit_Method.ipynb" role="button">
    <img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
</a>
</div><div class="px-2">
    <a href="https://colab.research.google.com/github/waltherg/georgio/blob/master/_notebooks/2013-12-03-Alternating_Direction_Implicit_Method.ipynb">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2013-12-03-Alternating_Direction_Implicit_Method.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />
<p>layout: default
title: "The Alternating Direction Implicit Method"
date: 2013-12-03
author: Georg R Walther</p>
<h2 id="tags:-wip">tags: wip<a class="anchor-link" href="#tags:-wip">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>This post is work in progress</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Alternating-Direction-Implicit-Method">The Alternating Direction Implicit Method<a class="anchor-link" href="#The-Alternating-Direction-Implicit-Method">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Just as the <a href="http://georg.io/2013/12/03/Crank_Nicolson.html">Crank-Nicolson (CN) method</a> for reaction-diffusion
systems with one space dimension, the 
<a href="http://en.wikipedia.org/wiki/Alternating_direction_implicit_method">Alternating Direction Implicit (ADI) method</a>
is used commonly for reaction-diffusion systems with two space dimensions.</p>
<p>The ADI method has been described thoroughly many times, for instance by
<a href="http://www.sciencedirect.com/science/article/pii/S0377042700004520">Dehghan</a>.</p>
<p>In the following discussion we will consider a reaction-diffusion system similar to the one we
studied <a href="http://georg.io/2013/12/03/Crank_Nicolson.html">previously</a> and we will use analogous
<a href="http://en.wikipedia.org/wiki/Neumann_boundary_condition">Neumann boundary conditions</a>.</p>
$$\frac{\partial u}{\partial t} = D \left( \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} \right) + f(u),$$$$\frac{\partial u}{\partial x}\Bigg|_{x = 0, L_x} = 0,$$$$\frac{\partial u}{\partial y}\Bigg|_{y = 0, L_y} = 0,$$<p>where $u(x,y,t)$ is our concentration variable, $D$ is the diffusion coefficient of $u$, $f$ is the reaction term, and $L_x$ and $L_y$ are the extent of our domain in the $x$ and $y$ direction respectively.</p>
<p>Since ADI and CN are somewhat related, let us try to derive the most basic properties of the ADI in relation to CN.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Grid-Construction">Grid Construction<a class="anchor-link" href="#Grid-Construction">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Analogous to the $(x,t)$-grid
<a href="http://georg.io/2013/12/03/Crank_Nicolson.html#finite_difference_methods">used in CN</a>,
we need to construct an $(x,y,t)$-grid for this problem with two space dimensions.</p>
<p>In the simplest case, we construct a <a href="http://en.wikipedia.org/wiki/Regular_grid">regular grid</a> as follows</p>
$$t_n = n \Delta t,~ n = 0, \ldots, N-1,$$$$x_j = j \Delta x,~ j = 0, \ldots, J-1,$$$$y_i = i \Delta y,~ i = 0, \ldots, I-1,$$<p>where $N$, $J$, and $I$ are the number of grid points in the $t$-, $x$-, and $y$-direction.</p>
<p>$\Delta t$, $\Delta x$, and $\Delta y$ are defined as follows</p>
$$\Delta t = \frac{T}{N-1},~ \Delta x = \frac{L_x}{J-1},~ \Delta y = \frac{L_y}{I-1},$$<p>where $T$ is the total amount of time we are interested in.</p>
<p><a href="(http://georg.io/2013/12/03/Crank_Nicolson.html#finite_difference_methods">As before</a> we will refer to the
numerical approximations of the unknown analytic solution $u(x,y,t)$ in our grid points as</p>
$$U(j \Delta x, i \Delta y, n \Delta t) \approx u(j \Delta x, i \Delta y, n \Delta t),$$<p>and we use the shorthand $U(j \Delta x, i \Delta y, n \Delta t) = U_{j,i}^n.$
We also refer to the grid point $(j \Delta x, i \Delta y, n \Delta t)$ as $(j,i,n)$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Motivation-for-ADI">Motivation for ADI<a class="anchor-link" href="#Motivation-for-ADI">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When integrating the above reaction-diffusion equation numerically, we can still make use of the
<a href="http://georg.io/2013/12/03/Crank_Nicolson.html#the_cranknicolson_stencil">CN stencil</a>.</p>
<p>Applying the CN stencil to our reaction-diffusion equation on our $(x,y,t)$-grid, we obtain:</p>
$$\frac{U_{j,i}^{n+1} - U_{j,i}^n}{\Delta t} = 
\frac{D}{2 \Delta x^2} \left( U_{j+1,i}^n -
2 U_{j,i}^n + U_{j-1,i}^n + U_{j+1,i}^{n+1} - 2 U_{j,i}^{n+1} + U_{j-1,i}^{n+1}\right) +
\frac{D}{2 \Delta y^2} \left( U_{j,i+1}^n -
2 U_{j,i}^n + U_{j,i-1}^n + U_{j,i+1}^{n+1} - 2 U_{j,i}^{n+1} + U_{j,i-1}^{n+1}\right) +
f(U_{j,i}^n).$$<p>Let us define $\sigma_x = \frac{D \Delta t}{2 \Delta x^2}$ and $\sigma_y = \frac{D \Delta t}{2 \Delta y^2}$.</p>
<p>To <a href="http://georg.io/2013/12/03/Crank_Nicolson.html#reordering_stencil_into_linear_system">reorder our stencil</a> into a linear system
we need to define a new index that combines indices $i$ and $j$:</p>
$$k = j + i J$$<p>This new index $k$ flattens the two-dimensional spatial part of our $(x,y,t)$-grid into a (one-dimensional) vector
and our "flattening methodology" is analogous to the <a href="http://en.wikipedia.org/wiki/Row-major_order">row-major order</a>
representation of matrices.</p>
<p>To illustrate, when we use the $k$ index grid points $(j,i,n)$ and $(j,i+1,n)$ become $(k,n)$ and $(k+J,n)$ respectively.</p>
<p>Our stencil therefore becomes</p>
$$U_{k}^{n+1} - U_{k}^n = 
\sigma_x \left( U_{k+1}^n -
2 U_{k}^n + U_{k-1}^n + U_{k+1}^{n+1} - 2 U_{k}^{n+1} + U_{k-1}^{n+1}\right) +
\sigma_y \left( U_{k+J}^n -
2 U_{k}^n + U_{k-J}^n + U_{k+J}^{n+1} - 2 U_{k}^{n+1} + U_{k-J}^{n+1}\right) +
\Delta t f(U_{k}^n),$$<p>and reordering this expression, we obtain</p>
$$
-\sigma_y U_{k-J}^{n+1}
-\sigma_x U_{k-1}^{n+1}
+ (1 + 2 \sigma_x + 2 \sigma_y) U_{k}^{n+1}
-\sigma_x U_{k+1}^{n+1}
-\sigma_y U_{k+J}^{n+1} =
\sigma_y U_{k-J}^n
+\sigma_x U_{k-1}^n
+(1 - 2 \sigma_x - 2 \sigma_y) U_{k}^n
+\sigma_x U_{k+1}^n
+\sigma_y U_{k+J}^n
+\Delta t f(U_{k}^n).$$<p>If we <a href="http://georg.io/2013/12/03/Crank_Nicolson.html#reordering_stencil_into_linear_system">wrote this out in matrix notation</a>, we would
see 
<a href="http://publib.boulder.ibm.com/infocenter/clresctr/vxrx/index.jsp?topic=%2Fcom.ibm.cluster.essl.v5r2.essl100.doc%2Fam5gr_bandma.htm">banded matrices</a> 
both on the left- and right-hand side (analogous to matrices $A$ and $B$
<a href="http://georg.io/2013/12/03/Crank_Nicolson.html#reordering_stencil_into_linear_system">in the one-dimensional case</a>):</p>
<p>On the left-hand side of this liner system, matrix $A$ contains a
tridiagonal core <a href="http://georg.io/2013/12/03/Crank_Nicolson.html#reordering_stencil_into_linear_system">as before</a> with
non-zero elements, $-\sigma_y$, in the $J$-th <a href="http://en.wikipedia.org/wiki/Diagonal#Matrices">sub- and superdiagonals</a>.
Matrix $B$ on the right-hand side looks similar but with $\sigma_y$ in the $J$-th sub- and superdiagonals.</p>
<p>Numerical inversion of banded matrices, such as $A$, is <a href="http://en.wikipedia.org/wiki/Alternating_direction_implicit_method">expensive</a>
with standard methods - at the very least we would not be able to use the standard
<a href="http://en.wikipedia.org/wiki/Tridiagonal_matrix_algorithm">Thomas algorithm</a> for tridiagonal matrices.</p>
<p>The <a href="http://en.wikipedia.org/wiki/Alternating_direction_implicit_method">ADI stencil</a> makes use of a trick that allows us to invert
tridiagonal matrices, just as with the 
<a href="http://georg.io/2013/12/03/Crank_Nicolson.html#the_cranknicolson_stencil">CN stencil</a>,
instead of banded matrices.</p>
<p>The ADI stencil also suggests a straightforward way to implement a parallelized variant of the ADI method and we will discuss and
demonstrate this below.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-ADI-Stencils">The ADI Stencils<a class="anchor-link" href="#The-ADI-Stencils">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The trick used in constructing the ADI method is to split our time step $\Delta t$ into two and apply two different stencils in each
half time step:
therefore to increment time by one time step $n \rightarrow n+1$ in grid point $(j,i,n)$, we first compute $U_{j,i}^{n+1/2}$
($n \rightarrow n+1/2$) and then compute $U_{j,i}^{n+1}$ ($n+1/2 \rightarrow n+1$).
Both of these stencils are chosen such that the resulting linear system is tridiagonal.</p>
<p>The two <a href="http://en.wikipedia.org/wiki/Alternating_direction_implicit_method">ADI stencils</a> 
bring in the $x$- and $y$-direction at the next time point
(<a href="http://en.wikipedia.org/wiki/Finite_difference_method#Implicit_method">implicit</a> v
<a href="http://en.wikipedia.org/wiki/Finite_difference_method#Explicit_method">explicit</a> finite difference stencils) alternatingely -
inspiring the name of the ADI method:</p>
$$\frac{U_{j,i}^{n+1/2} - U_{j,i}^n}{\Delta t / 2} = 
\frac{D}{\Delta x^2} \left( U_{j+1,i}^{n+1/2} - 2 U_{j,i}^{n+1/2} + U_{j-1,i}^{n+1/2} \right) +
\frac{D}{\Delta y^2} \left( U_{j,i+1}^n - 2 U_{j,i}^n + U_{j,i-1}^n \right) +
f(U_{j,i}^n),$$$$\frac{U_{j,i}^{n+1} - U_{j,i}^{n+1/2}}{\Delta t / 2} = 
\frac{D}{\Delta x^2} \left( U_{j+1,i}^{n+1/2} - 2 U_{j,i}^{n+1/2} + U_{j-1,i}^{n+1/2} \right) +
\frac{D}{\Delta y^2} \left( U_{j,i+1}^{n+1} - 2 U_{j,i}^{n+1} + U_{j,i-1}^{n+1} \right) +
f(U_{j,i}^{n+1/2}).$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-ADI-Linear-Systems">The ADI Linear Systems<a class="anchor-link" href="#The-ADI-Linear-Systems">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="http://georg.io/2013/12/03/Crank_Nicolson.html">As before</a> we define $\sigma_x = \frac{D \Delta t}{2 \Delta x^2}$ and 
$\sigma_y = \frac{D \Delta t}{2 \Delta y^2}$.</p>
<p>Reordering both stencils, we obtain the following systems of linear equations</p>
$$
-\sigma_x U_{j-1,i}^{n+1/2} + (1+2\sigma_x) U_{j,i}^{n+1/2} - \sigma_x U_{j+1,i}^{n+1/2} =
\sigma_y U_{j,i+1}^n + (1-2\sigma_y) U_{j,i}^n + \sigma_y U_{j,i-1}^n + \frac{\Delta t}{2} f(U_{j,i}^n),
$$$$
-\sigma_y U_{j,i+1}^{n+1} + (1+2\sigma_y) U_{j,i}^{n+1} - \sigma_y U_{j,i-1}^{n+1} =
\sigma_x U_{j-1,i}^{n+1/2} + (1-2\sigma_x) U_{j,i}^{n+1/2} + \sigma_x U_{j+1,i}^{n+1/2} + \frac{\Delta t}{2} f(U_{j,i}^{n+1/2}).
$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Family-of-Linear-Systems-in-the-$x$-Direction">Family of Linear Systems in the $x$-Direction<a class="anchor-link" href="#Family-of-Linear-Systems-in-the-$x$-Direction">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consider the stencil pictured in 
<a href="http://www.sciencedirect.com/science/article/pii/S0377042700004520#FIG1">Dehghan Figure 1</a>
and let us think of the matrix defined by $\left(U_{j,i}^n\right)$ 
($j=0,\ldots,J-1$, $i=0\ldots,I-1$, $n$ held constant) as a concentration plane.</p>
<p>We realize that for fixed index $i$ the first of our two equations above define a
system of linear equations similar to the linear system we obtained for
<a href="http://georg.io/2013/12/03/Crank_Nicolson.html#reordering_stencil_into_linear_system">CN with one space dimension</a>.
As for CN with one space dimension we need to amend certain entries of our linear system to
accommodate our Neumann boundary conditions on the edges of our grid.
In fact we need to accommodate boundary conditions in both the $x$- and $y$-direction.</p>
<p>Our first equation does not need to be modified for grid points that lie "within" the
spatial part of our grid, i.e. $(j,i,n)$ for $j=1,\ldots,J-2$, $i=1,\ldots,I-2$, and $n=0,1,2,\ldots$:</p>
$$
-\sigma_x U_{j-1,i}^{n+1/2} + (1+2\sigma_x) U_{j,i}^{n+1/2} - \sigma_x U_{j+1,i}^{n+1/2} =
\sigma_y U_{j,i+1}^n + (1-2\sigma_y) U_{j,i}^n + \sigma_y U_{j,i-1}^n + \frac{\Delta t}{2} f(U_{j,i}^n).
$$<p>Let us take a look at what happens for grid points on the far left and right with $j=0,J-1$ and $i=1,\ldots,I-2$:</p>
$$
j=0:~ (1+\alpha_x) U_{0,i}^{n+1/2} - \alpha_x U_{1,i}^{n+1/2} =
\alpha_y U_{0,i-1}^n + (1-2\alpha_y) U_{0,i}^n + \alpha_y U_{0,i+1}^n + \Delta t f(U_{0,i}^n),
$$$$
j=J-1:~ -\alpha_x U_{J-2,i}^{n+1/2} + (1+\alpha_x) U_{J-1,i}^{n+1/2} =
\alpha_y U_{J-1,i-1}^n + (1-2\alpha_y) U_{J-1,i}^n + \alpha_y U_{J-1,i+1}^n + \Delta t f(U_{J-1,i}^n).
$$<p>On the left-hand side of the linear system defined by these three expressions (imagine varying $j=0,1,\ldots,J-1$)
we can already make out essentially the same matrix as we constructed for
<a href="http://georg.io/2013/12/03/Crank_Nicolson.html#reordering_stencil_into_linear_system">CN with one space dimension</a>.
Note that this matrix is the same for all indeces $i=0,1,\ldots,I-1$.</p>
<p>This completes incorporating our boundary conditions in the $x$-direction.
Before we move on to doing the same with our boundary conditions in the $y$-direction let us
state clearly that our $(x,y)$-concentration plane has
<a href="http://en.wikipedia.org/wiki/Cartesian_coordinate_system#In_two_dimensions">right-handed orientation</a>
meaning that $x$ increases <em>left to right</em> and $y$ increases <em>bottom to top</em>.
Our grid has the same orientation so that index $j$ incrases <em>left to right</em> and
index $i$ increases <em>bottom to top</em>.</p>
<p>Let us now take a look at this equation for $j=1,\ldots,J-2$ and $i=0$ (bottom) and $i=I-1$ (top):</p>
$$
i=0:~ -\alpha_x U_{j-1,0}^{n+1/2} + (1+2\alpha_x) U_{j,0}^{n+1/2} - \alpha_x U_{j+1,0}^{n+1/2} =
(1-\alpha_y) U_{j,0}^n + \alpha_y U_{j,1}^n + \Delta t f(U_{j,0}^n),
$$$$
i=I-1:~ -\alpha_x U_{j-1,I-1}^{n+1/2} + (1+2\alpha_x) U_{j,I-1}^{n+1/2} - \alpha_x U_{j+1,I-1}^{n+1/2} =
\alpha_y U_{j,I-2}^n + (1-\alpha_y) U_{j,I-1}^n + \Delta t f(U_{j,I-1}^n).
$$<p>To rewrite these equations in compact matrix notation, let us define a horizontal slice (<em>left to right</em>)
through our concentration plane as vector</p>
$$\mathbf{U}_{x,i}^n = \begin{bmatrix}U_{0,i}^n, &amp; \ldots, &amp; U_{J-1,i}^n \end{bmatrix}$$<p>We can now combine all of the above and write the first of our two families of ADI linear systems compactly:</p>
$$A \mathbf{U}_{x,i}^{n+1/2} = \mathbf{b}_i + \mathbf{f}\left( \Delta t \mathbf{U}_{x,i}^n \right),~i=0,\ldots,I-1,$$<p>where</p>
$$A = \begin{bmatrix}
1+\alpha_x &amp; -\alpha_x &amp; 0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
-\alpha_x &amp; 1+2\alpha_x &amp; -\alpha_x &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; -\alpha_x &amp; 1+2\alpha_x &amp; -\alpha_x &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -\alpha_x &amp; 1+2\alpha_x &amp; -\alpha_x \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -\alpha_x &amp; 1+\alpha_x
\end{bmatrix}.$$<p>The form of vector $\mathbf{b}_i$ depends on $i$:</p>
$$i=I-1:~ \mathbf{b}_{I-1} = 
\begin{bmatrix}
(1-\alpha_y) U_{0,I-1}^n + \alpha_y U_{0,I-2}^n \\
\vdots \\
(1-\alpha_y) U_{J-1,I-1}^n + \alpha_y U_{J-1,I-2}^n
\end{bmatrix}$$$$i=I-2,\ldots,1:~ \mathbf{b}_i = 
\begin{bmatrix}
\alpha_y U_{0,i+1}^n + (1-2\alpha_y) U_{0,i}^n + \alpha_y U_{0,i-1}^n \\
\vdots \\
\alpha_y U_{J-1,i+1}^n + (1-2\alpha_y) U_{J-1,i}^n + \alpha_y U_{J-1,i-1}^n
\end{bmatrix}$$$$i=0:~ \mathbf{b}_0 = 
\begin{bmatrix}
\alpha_y U_{0,1}^n + (1-\alpha_y) U_{0,0}^n \\
\vdots \\
\alpha_y U_{J-1,1}^n + (1-\alpha_y) U_{J-1,0}^n
\end{bmatrix}.$$<p>The reaction term vector is</p>
$$\mathbf{f}\left( \Delta t \mathbf{U}_{x,i}^n \right) = 
\begin{bmatrix}
\Delta t f(U_{0,i}^n), &amp; \ldots, &amp; \Delta t f(U_{J-1,i}^n)
\end{bmatrix}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Family-of-Linear-Systems-in-the-$y$-Direction">Family of Linear Systems in the $y$-Direction<a class="anchor-link" href="#Family-of-Linear-Systems-in-the-$y$-Direction">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us first define a vertical (<em>from top to bottom</em>) slice through our concentration plane
(note our comment on 
<a href="http://en.wikipedia.org/wiki/Cartesian_coordinate_system#In_two_dimensions">right-handedness</a> above) as:</p>
$$\mathbf{U}_{y,j}^n = \begin{bmatrix}U_{j,I-1}^n, &amp; U_{j,I-2}^n, &amp; \ldots, &amp; U_{j,0}^n \end{bmatrix}$$<p>Following an equivalent procedure to above for the second family of ADI linear systems we obtain:</p>
$$C \mathbf{U}_{y,j}^{n+1} = \mathbf{d}_j + \mathbf{f}\left( \Delta t \mathbf{U}_{y,j}^{n+1/2} \right),~j=0,\ldots,J-1,$$<p>where</p>
$$C = \begin{bmatrix}
1+\alpha_y &amp; -\alpha_y &amp; 0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
-\alpha_y &amp; 1+2\alpha_y &amp; -\alpha_y &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; -\alpha_y &amp; 1+2\alpha_y &amp; -\alpha_y &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \ddots &amp; \ddots &amp; \ddots &amp; \ddots &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -\alpha_y &amp; 1+2\alpha_y &amp; -\alpha_y \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -\alpha_y &amp; 1+\alpha_y
\end{bmatrix}.$$<p>The form of vector $\mathbf{d}_j$ depends on $j$:</p>
$$j=0:~ \mathbf{d}_0 = 
\begin{bmatrix}
(1-\alpha_x) U_{0,I-1}^{n+1/2} + \alpha_x U_{1,I-1}^{n+1/2} \\
(1-\alpha_x) U_{0,I-2}^{n+1/2} + \alpha_x U_{1,I-2}^{n+1/2} \\
\vdots \\
(1-\alpha_x) U_{0,0}^{n+1/2} + \alpha_x U_{1,0}^{n+1/2}
\end{bmatrix}$$$$j=1,\ldots,J-2:~ \mathbf{d}_j = 
\begin{bmatrix}
\alpha_x U_{j-1,I-1}^{n+1/2} + (1-2\alpha_x) U_{j,I-1}^{n+1/2} + \alpha_x U_{j+1,I-1}^{n+1/2} \\
\alpha_x U_{j-1,I-2}^{n+1/2} + (1-2\alpha_x) U_{j,I-2}^{n+1/2} + \alpha_x U_{j+1,I-2}^{n+1/2} \\
\vdots \\
\alpha_x U_{j-1,0}^{n+1/2} + (1-2\alpha_x) U_{j,0}^{n+1/2} + \alpha_x U_{j+1,0}^{n+1/2}
\end{bmatrix}$$$$j=J-1:~ \mathbf{d}_{J-1} = 
\begin{bmatrix}
\alpha_x U_{J-2,I-1}^{n+1/2} + (1-\alpha_x) U_{J-1,I-1}^{n+1/2} \\
\alpha_x U_{J-2,I-2}^{n+1/2} + (1-\alpha_x) U_{J-1,I-2}^{n+1/2} \\
\vdots \\
\alpha_x U_{J-2,0}^{n+1/2} + (1-\alpha_x) U_{J-1,0}^{n+1/2}
\end{bmatrix}$$<p>The reaction term vector is</p>
$$\mathbf{f}\left( \Delta t \mathbf{U}_{y,j}^{n+1/2} \right) = 
\begin{bmatrix}
\Delta t f(U_{j,I-1}^{n+1/2}), &amp; \Delta t f(U_{j,I-2}^{n+1/2}), &amp; \ldots, &amp; \Delta t f(U_{j,0}^{n+1/2})
\end{bmatrix}$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parallelism-in-the-ADI">Parallelism in the ADI<a class="anchor-link" href="#Parallelism-in-the-ADI">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To summarize, the ADI stencil generates two families of linear systems that we need to solve iteratively:</p>
$$A \mathbf{U}_{x,i}^{n+1/2} = \mathbf{b}_i + \mathbf{f}\left( \Delta t \mathbf{U}_{x,i}^n \right),~i=0,\ldots,I-1,$$$$C \mathbf{U}_{y,j}^{n+1} = \mathbf{d}_j + \mathbf{f}\left( \Delta t \mathbf{U}_{y,j}^{n+1/2} \right),~j=0,\ldots,J-1.$$<p>Upon closer inspection, we realize that we can solve the $I$ linear systems of the first family in parallel.
To see this let us take a look at two arbitrary linear systems out of this family:</p>
$$A \mathbf{U}_{x,i_1}^{n+1/2} = \mathbf{b}_{i_1} + \mathbf{f}\left( \Delta t \mathbf{U}_{x,i_1}^n \right),$$$$A \mathbf{U}_{x,i_2}^{n+1/2} = \mathbf{b}_{i_2} + \mathbf{f}\left( \Delta t \mathbf{U}_{x,i_2}^n \right).$$<p>As we can see, there is no interdependence between the linear systems for indeces $i_1$ and $i_2$ that would prevent
us from solving these in parallel.</p>
<p>The same reasoning can be applied to our second family of linear systems.
We can solve the linear systems of all indeces $j$ of that family in parallel.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="An-ADI-Example-in-Python">An ADI Example in Python<a class="anchor-link" href="#An-ADI-Example-in-Python">&#182;</a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">J</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">I</span> <span class="o">=</span> <span class="mi">10</span>

<span class="nb">print</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">str</span><span class="p">((</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[&#39;(0, 9)&#39; &#39;(1, 9)&#39; &#39;(2, 9)&#39; &#39;(3, 9)&#39; &#39;(4, 9)&#39;]
 [&#39;(0, 8)&#39; &#39;(1, 8)&#39; &#39;(2, 8)&#39; &#39;(3, 8)&#39; &#39;(4, 8)&#39;]
 [&#39;(0, 7)&#39; &#39;(1, 7)&#39; &#39;(2, 7)&#39; &#39;(3, 7)&#39; &#39;(4, 7)&#39;]
 [&#39;(0, 6)&#39; &#39;(1, 6)&#39; &#39;(2, 6)&#39; &#39;(3, 6)&#39; &#39;(4, 6)&#39;]
 [&#39;(0, 5)&#39; &#39;(1, 5)&#39; &#39;(2, 5)&#39; &#39;(3, 5)&#39; &#39;(4, 5)&#39;]
 [&#39;(0, 4)&#39; &#39;(1, 4)&#39; &#39;(2, 4)&#39; &#39;(3, 4)&#39; &#39;(4, 4)&#39;]
 [&#39;(0, 3)&#39; &#39;(1, 3)&#39; &#39;(2, 3)&#39; &#39;(3, 3)&#39; &#39;(4, 3)&#39;]
 [&#39;(0, 2)&#39; &#39;(1, 2)&#39; &#39;(2, 2)&#39; &#39;(3, 2)&#39; &#39;(4, 2)&#39;]
 [&#39;(0, 1)&#39; &#39;(1, 1)&#39; &#39;(2, 1)&#39; &#39;(3, 1)&#39; &#39;(4, 1)&#39;]
 [&#39;(0, 0)&#39; &#39;(1, 0)&#39; &#39;(2, 0)&#39; &#39;(3, 0)&#39; &#39;(4, 0)&#39;]]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L_x</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">L_y</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="n">J</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">I</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">dx</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">L_x</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">L_y</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x_grid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">j</span><span class="o">*</span><span class="n">dx</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)])</span>
<span class="n">y_grid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="n">dy</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>
<span class="n">t_grid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">*</span><span class="n">dt</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">D_U</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">D_V</span> <span class="o">=</span> <span class="mf">10.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tot_protein</span> <span class="o">=</span> <span class="mf">2.26</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">no_high</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">U</span> <span class="o">=</span>  <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.1</span> <span class="k">if</span> <span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="n">no_high</span> <span class="k">else</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>

<span class="n">U_protein</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">U</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span>
<span class="n">V_protein_px</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tot_protein</span><span class="o">-</span><span class="n">U_protein</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">J</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">V_protein_px</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">J</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>

<span class="nb">print</span> <span class="s1">&#39;Initial protein mass&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">U</span><span class="p">))</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">V</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Initial protein mass 2.26
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2.1</span><span class="p">)</span>
<span class="n">colorbar</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>
<span class="n">colorbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;concentration U&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
LjdyR2qrTwAAAABJRU5ErkJggg==
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alpha_x_U</span> <span class="o">=</span> <span class="n">D_U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="n">alpha_y_U</span> <span class="o">=</span> <span class="n">D_U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>

<span class="n">alpha_x_V</span> <span class="o">=</span> <span class="n">D_V</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="n">alpha_y_V</span> <span class="o">=</span> <span class="n">D_V</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">A_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_x_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span>\
    <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_x_U</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_x_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_x_U</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span><span class="o">+</span>\
    <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_x_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
    
<span class="n">C_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span>\
      <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_y_U</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_y_U</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span><span class="o">+</span>\
      <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
        
<span class="n">A_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_x_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span>\
    <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_x_V</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_x_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_x_V</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span><span class="o">+</span>\
    <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_x_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
    
<span class="n">C_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span>\
      <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_y_V</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="mf">1.</span><span class="o">+</span><span class="n">alpha_y_V</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span><span class="o">+</span>\
      <span class="n">numpy</span><span class="o">.</span><span class="n">diagflat</span><span class="p">([</span><span class="o">-</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f_vec</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mf">2.</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> 
                     <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">U</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">U</span><span class="p">))))),</span> <span class="n">U</span><span class="p">))</span>

<span class="n">k0</span> <span class="o">=</span> <span class="mf">0.067</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b_t_stencil_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_y_U</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]])</span>
<span class="n">b_c_stencil_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]])</span>
<span class="n">b_b_stencil_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_y_U</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_y_U</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]])</span>

<span class="n">b_t_stencil_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_y_V</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]])</span>
<span class="n">b_c_stencil_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]])</span>
<span class="n">b_b_stencil_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_y_V</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)],</span>
                             <span class="p">[(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_y_V</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">)]])</span>

<span class="n">d_l_stencil_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_x_U</span><span class="p">,</span> <span class="n">alpha_x_U</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>
<span class="n">d_c_stencil_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_x_U</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_x_U</span><span class="p">,</span> <span class="n">alpha_x_U</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>
<span class="n">d_r_stencil_U</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_x_U</span><span class="p">,</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_x_U</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>
                             
<span class="n">d_l_stencil_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha_x_V</span><span class="p">,</span> <span class="n">alpha_x_V</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>
<span class="n">d_c_stencil_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_x_V</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha_x_V</span><span class="p">,</span> <span class="n">alpha_x_V</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>
<span class="n">d_r_stencil_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">alpha_x_V</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">alpha_x_V</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">)])</span>

<span class="n">f_curr</span> <span class="o">=</span> <span class="n">f_vec</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">b_U</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">I</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">U_y</span> <span class="o">=</span> <span class="n">U</span><span class="p">[[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">U_y</span><span class="o">+</span><span class="n">b_c_stencil_U</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">U_y</span> <span class="o">=</span> <span class="n">U</span><span class="p">[[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">U_y</span><span class="o">+</span><span class="n">b_t_stencil_U</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">U_y</span> <span class="o">=</span> <span class="n">U</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">U_y</span><span class="o">+</span><span class="n">b_b_stencil_U</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">b_V</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">I</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">V_y</span> <span class="o">=</span> <span class="n">V</span><span class="p">[[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">V_y</span><span class="o">+</span><span class="n">b_c_stencil_V</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">V_y</span> <span class="o">=</span> <span class="n">V</span><span class="p">[[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">V_y</span><span class="o">+</span><span class="n">b_t_stencil_V</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[[</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">I</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">V_y</span> <span class="o">=</span> <span class="n">V</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">V_y</span><span class="o">+</span><span class="n">b_b_stencil_V</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">d_U</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">J</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">U_x</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">U_x</span><span class="o">+</span><span class="n">d_c_stencil_U</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[:,</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">U_x</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">U_x</span><span class="o">+</span><span class="n">d_l_stencil_U</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">U_x</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span> <span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">U_x</span><span class="o">+</span><span class="n">d_r_stencil_U</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[:,</span> <span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">d_V</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">J</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">V_x</span> <span class="o">=</span> <span class="n">V</span><span class="p">[:,</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">V_x</span><span class="o">+</span><span class="n">d_c_stencil_V</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[:,</span> <span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">V_x</span> <span class="o">=</span> <span class="n">V</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">V_x</span><span class="o">+</span><span class="n">d_l_stencil_V</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">V_x</span> <span class="o">=</span> <span class="n">V</span><span class="p">[:,</span> <span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">V_x</span><span class="o">+</span><span class="n">d_r_stencil_V</span><span class="p">,</span> <span class="n">f_curr</span><span class="p">[:,</span> <span class="p">[</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;time = </span><span class="si">%.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;total protein = </span><span class="si">%.6f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">U</span><span class="p">))</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">V</span><span class="p">))))</span>
    <span class="n">f_curr</span> <span class="o">=</span> <span class="n">f_vec</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">I</span><span class="p">):</span>
        <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A_U</span><span class="p">,</span> <span class="n">b_U</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A_V</span><span class="p">,</span> <span class="n">b_V</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">J</span><span class="p">):</span>
        <span class="n">U</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">C_U</span><span class="p">,</span> <span class="n">d_U</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
        <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">C_V</span><span class="p">,</span> <span class="n">d_V</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="n">J</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2.1</span><span class="p">)</span>
<span class="n">colorbar</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>
<span class="n">colorbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;concentration U&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>


  </div><a class="u-url" href="/2013/12/03/Alternating_Direction_Implicit_Method.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">georg.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">georg.io</li><li><a class="u-email" href="mailto:contact@georg.io">contact@georg.io</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list">
  <li><a href="https://github.com/waltherg"><svg class="social svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">waltherg</span></a></li><li><a href="https://www.twitter.com/georgrwalther"><svg class="social svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">georgrwalther</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>My personal blog on tech and data</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
